# 项目文档：小型Web应用 - 用户注册与登录功能
***
## 一、项目概述
本项目是一个基于Spring Boot框架开发的小型Web应用，主要实现了用户的注册与登录功能。应用采用前后端分离的设计模式，前端负责界面展示与交互逻辑，后端提供RESTful API接口，处理业务逻辑与数据库交互。
旨在为用户提供一个登录注册平台，并为后续扩展其他功能模块奠定基础。
***
## 二、应用架构
### （一）前端
- 使用HTML,实现表单验证，提升用户体验。
- 负责展示登录注册界面给用户，收集用户输入的数据。
### （二）后端
- 使用pring Boot, 提供了快速开发RESTful API的能力
- 处理来自前端的所有请求，验证用户凭证，执行数据库操作。
### （三）数据持久层 (Data Persistence Layer)
- 通过Spring Data JPA与MySQL数据库交互，进行用户信息的存储和查询。
### （四）部署环境 (Deployment Environment)
- 应用部署在本地服务器上，需要访问 http://localhost:8080/login
***
## 三、技术选型
### （一）前端技术栈
- HTML/CSS/JavaScript: 基础网页构建技术。
### （二）后端技术栈
- Spring Boot: 快速构建生产级Spring应用的框架，简化配置，快速集成各种Spring组件和服务。
- Spring Data JPA: 用于简化数据库操作，特别是面向对象的持久化。
### （三）数据库技术
- MySQL: 关系型数据库管理系统，适合处理结构化数据，如用户信息。
### （四）部署与运维:
- 本地服务器部署: 直接在开发者的机器上运行应用，简便快捷，适用于开发和测试环境。
***
## 四、主要代码逻辑说明
***
### （一）Controller层
#### 1. 用户注册 (/api/auth/register POST)：
- **功能描述**：此端点允许用户通过发送包含用户名、密码等信息的JSON请求来注册新账户。它接收一个User对象作为请求体。
- **处理逻辑**：
  - 尝试使用userService.register(user)方法注册用户
  - 如果注册成功（返回的newUser不为null），则构造一个包含"success"状态、成功消息及新用户信息的响应体，并以HTTP状态码201（Created）返回，表明资源已成功创建。
  - 如果注册失败（如用户名已存在），则返回状态为"error"的消息及HTTP状态码400（Bad Request）。
  - 对于任何未预期的异常，返回带有"error"状态和内部服务器错误消息的响应，HTTP状态码为500（Internal Server Error）。

#### 2. 用户登录 (/api/auth/login POST)：
- **功能描述**：此端点用于用户登录验证，接收包含用户名和密码的User对象作为请求体。
- **处理逻辑**：
    - 使用userService.authenticateUser(user)方法验证用户凭据。
    - 若验证成功，返回状态为"success"和登录成功消息的响应，HTTP状态码为200（OK）。
    - 若用户名或密码错误，返回状态为"error"和无效凭据消息的响应，HTTP状态码为401（Unauthorized）。
    - 遇到任何异常时，同样返回带有"error"状态的响应和内部服务器错误消息，HTTP状态码500。

#### 3. 检查用户名可用性 (/api/auth/check-username GET)：
- **功能描述**：此端点允许客户端查询指定用户名是否可用，通过查询参数username传递待检查的用户名。
- **处理逻辑**：
  - 调用userService.isUsernameAvailable(username)方法判断用户名是否已被占用。
  - 响应包含一个UserNameAvailabilityResponse对象，其中指明了查询的用户名及其可用状态。
  - 无论用户名是否可用，均以HTTP状态码200（OK）返回结果。

以上，AuthController负责处理用户注册、登录及用户名查询的HTTP请求，利用UserService进行业务逻辑处理，确保了与用户认证相关的功能得以实现。接下来，请提供UserService、UserRepository、User实体类的代码片段，以及关于HTML注册和登录页面的简要描述，以便进一步完善文档。
***
### （二）Entity层
#### 1. User实体
- **类说明**：User类代表系统中的用户实体，存储在数据库的users表中。它使用Lombok库简化了getter、setter、无参构造器和全参构造器的定义。
- **属性**：
  - **id**: 用户的唯一标识符，由数据库自动生成。
  - **username**: 用户名，是必须且唯一的字段，长度限制在3到50个字符之间，确保了用户名的合理性和数据库索引的唯一性。
  - **password**: 用户密码，长度要求至少6个字符，最多100个字符
#### 2. UserNameAvailabilityResponse实体
- **类说明**：此类用于响应用户名查询的可用性检查请求，简单包含查询的用户名及该用户名是否可用的布尔值。
- **属性**：
  - **username**: 查询的用户名字符串。
  - **available**: 布尔值，表示该用户名是否可用。true表示用户名未被占用，可注册；false表示用户名已被使用。
***
### （三）Repository层
##### UserRepository接口
- **接口说明**：UserRepository接口继承自JpaRepository，是Spring Data JPA提供的一个核心接口，用于执行CRUD（创建Create、读取Read、更新Update、删除Delete）操作。它专门针对User实体进行数据库操作。
- **方法:** 
  - findByUsername(String username): 根据用户名查询用户信息，返回一个Optional<User>。Optional容器可以更好地处理可能不存在的结果，避免空指针异常。
  - existsByUsername(String username): 检查数据库中是否存在指定的用户名，返回一个布尔值。此方法对于验证用户名唯一性非常有用，例如在用户注册时检查用户名是否已被占用。

通过这些方法定义，UserRepository提供了直接与数据库交互的能力，使得服务层能够方便地实现业务逻辑，如用户认证、注册处理等
***
### （四）UserService层
##### UserService类
- **服务说明**：UserService类是业务逻辑层的核心，它负责处理与用户相关的业务操作，如注册、认证等。通过注入UserRepository，实现了数据访问层与业务逻辑层的解耦。
- **方法**：
  - isUsernameAvailable(String username)：检查给定的用户名是否可用。通过调用userRepository.existsByUsername(username)判断数据库中是否存在相同的用户名，返回布尔值。
  - register(User user)：用户注册方法。首先检查用户名是否已存在，若存在则抛出IllegalArgumentException异常。用户名唯一时，调用userRepository.save(user)保存用户信息到数据库，并返回保存后的用户对象。
  - authenticateUser(User user)：用户认证方法。根据提供的用户名查询用户，使用userRepository.findByUsername(user.getUsername())获取一个Optional<User>。如果用户存在且提供的密码与数据库中存储的密码匹配，则返回用户对象，表示认证成功；否则返回null，表示认证失败（可能是用户名不存在或密码错误）。
***
### （五）前端部署描述
#### 登录页面 (login.html)
- **页面结构**：该页面包含一个简单的登录表单，用户需输入用户名和密码。页面标题为 "User Login"，布局清晰，易于导航
- **交互逻辑**：
  - 当表单提交时，通过JavaScript的fetch API向后端/api/auth/login发起POST请求，携带JSON格式的用户名和密码
  - 成功响应时，通过解析JSON数据并在控制台打印，弹窗提示登录成功，并自动重定向到首页index.html。
  - 如果登录失败，捕获错误并弹窗提示用户检查用户名和密码。

#### 注册页面 (register.html)
- **页面结构**：此页面用于新用户注册，包含用户名和密码输入框，以及注册按钮。页面标题为 "User Registration"，底部有链接引导已有账户的用户前往登录页面。
- **交互逻辑**：
  - 在用户尝试注册前，客户端首先通过异步GET请求到/api/auth/check-username检查所输入的用户名是否可用，有效避免了表单提交后再告知用户的问题。
  - 当用户点击“注册”按钮时，先调用checkUsernameOnSubmit函数验证用户名是否已存在且满足长度要求，然后调用validatePassword函数验证密码强度。
  - 两项验证都通过后，使用fetch API向/api/auth/register发送包含用户名和密码的POST请求以完成注册。
  - 成功注册后，页面会显示注册成功的提示信息，并自动跳转回登录页面；若注册失败，页面会展示相应的错误信息。
***
## 五、后续扩展与优化
1. 响应式设计：增强网页的响应式布局，确保在不同设备（如手机、平板、桌面）上都能提供良好的浏览和操作体验。
2. 实时表单验证：对于注册页面，增加前端实时验证，即时反馈用户名长度、密码强度等信息，提升用户体验，减少不必要的提交尝试。
3. 密码找回与重置：实现忘记密码功能，允许用户通过邮箱或手机号接收验证码来重置密码，提高用户便利性。
4. 双因素认证：为用户提供双因素认证（2FA）选项，如短信验证码、身份验证器应用生成的一次性密码，增加账户安全性。
5. 输入安全与过滤：在后端实现更全面的输入验证和输出编码，防御XSS（跨站脚本攻击）、SQL注入等安全威胁。
5. 日志审计：建立详细的日志记录系统，记录用户活动、异常登录尝试等，便于安全审计和问题追踪



